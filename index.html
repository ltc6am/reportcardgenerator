<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HK Report Card Generator v6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
    <!-- Favicon SVG -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ“</text></svg>">
    <style>
        body { 
            font-family: 'Noto Sans', sans-serif; 
            background: #f0f4f8;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }
        
        /* Glassmorphism Card Style */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            border-radius: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .vibe-card { 
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); 
            cursor: pointer; 
            position: relative;
            overflow: hidden;
        }
        .vibe-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 12px 20px -5px rgba(59, 130, 246, 0.15); 
            border-color: #93c5fd;
        }
        .vibe-card.active { 
            border-color: #3b82f6; 
            background-color: #eff6ff; 
            box-shadow: 0 0 0 2px #3b82f6;
        }
        
        /* Larger Chips */
        .word-chip { 
            transition: all 0.15s ease; 
            cursor: pointer; 
            user-select: none;
            font-size: 1rem; /* Increased size */
        }
        .word-chip:hover { 
            transform: translateY(-1px); 
            background-color: #f1f5f9;
            border-color: #64748b;
        }
        .word-chip.active { 
            background-color: #2563eb; 
            color: white; 
            border-color: #2563eb; 
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .word-chip.active:hover {
            background-color: #1d4ed8;
        }
        
        .step-badge { 
            width: 28px; 
            height: 28px; 
            border-radius: 8px; 
            background: #dbeafe; 
            color: #1e40af; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            font-weight: 800; 
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.8);
        }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Smooth reveal for instructions */
        .reveal-content {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.3s ease-out;
            opacity: 0;
        }
        .reveal-content.open {
            grid-template-rows: 1fr;
            opacity: 1;
            margin-bottom: 2rem;
        }
        .inner-content { overflow: hidden; }
    </style>
</head>
<body class="pb-48">

    <!-- Navbar -->
    <nav class="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-lg text-white shadow-lg shadow-blue-500/30">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M12 14l9-5-9-5-9 5 9 5z" />
                        <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight text-slate-800">Report Card Gen <span class="text-blue-600">v6</span></h1>
                </div>
            </div>
            <button onclick="toggleInstructions()" class="text-sm font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                How to Use?
            </button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-6 space-y-6">

        <!-- TOGGLEABLE INSTRUCTIONS -->
        <div id="instructions" class="reveal-content glass-card border-l-4 border-l-blue-500">
            <div class="inner-content p-6">
                <h2 class="text-lg font-bold text-slate-800 mb-4">Quick Guide</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm text-slate-600">
                    <div class="flex gap-3">
                        <div class="step-badge shrink-0">1</div>
                        <div>
                            <p class="font-bold text-slate-800 mb-1">Input Profile</p>
                            <p>Enter name and gender. Names are auto-capitalized (e.g., "tai man" â†’ "Tai Man").</p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <div class="step-badge shrink-0">2</div>
                        <div>
                            <p class="font-bold text-slate-800 mb-1">Select Vibe</p>
                            <p>Choose from 10 student profiles below that best match your student.</p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <div class="step-badge shrink-0">3</div>
                        <div>
                            <p class="font-bold text-slate-800 mb-1">Customize</p>
                            <p>Click the large word chips to adjust the tone, then copy the result.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 1: Student Details -->
        <section class="glass-card p-8">
            <h2 class="text-lg font-bold text-slate-700 mb-6 flex items-center gap-3">
                <span class="step-badge">1</span> Student Details
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-slate-400 mb-2">Student Name</label>
                    <input type="text" id="studentName" placeholder="e.g. Chan Tai Man" 
                        class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all font-medium text-lg placeholder-slate-300"
                        oninput="updatePreview()" onblur="autoFormatNameInput()">
                    <p class="text-[10px] text-slate-400 mt-1 pl-1">Auto-converts to Title Case</p>
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-slate-400 mb-2">Gender</label>
                    <div class="flex gap-4">
                        <label class="flex-1 relative group">
                            <input type="radio" name="gender" value="M" checked class="peer sr-only" onchange="handleGenderChange()">
                            <div class="p-4 flex items-center justify-center gap-2 border-2 border-slate-100 rounded-xl cursor-pointer bg-slate-50 hover:border-blue-200 peer-checked:bg-blue-50 peer-checked:border-blue-500 peer-checked:text-blue-700 transition-all">
                                <span class="text-xl">ðŸ‘¦</span> <span class="font-bold">Male</span>
                            </div>
                        </label>
                        <label class="flex-1 relative group">
                            <input type="radio" name="gender" value="F" class="peer sr-only" onchange="handleGenderChange()">
                            <div class="p-4 flex items-center justify-center gap-2 border-2 border-slate-100 rounded-xl cursor-pointer bg-slate-50 hover:border-pink-200 peer-checked:bg-pink-50 peer-checked:border-pink-500 peer-checked:text-pink-700 transition-all">
                                <span class="text-xl">ðŸ‘§</span> <span class="font-bold">Female</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Select Vibe -->
        <section class="glass-card p-8">
            <h2 class="text-lg font-bold text-slate-700 mb-6 flex items-center gap-3">
                <span class="step-badge">2</span> Select Student Profile
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-5" id="vibeContainer">
                <!-- Vibe Cards generated by JS -->
            </div>
        </section>

        <!-- SECTION 3: Customize Words -->
        <section id="customizationSection" class="glass-card p-8 hidden fade-in">
            <h2 class="text-lg font-bold text-slate-700 mb-6 flex items-center gap-3">
                <span class="step-badge">3</span> Customize Vocabulary
            </h2>
            <div id="wordPools" class="space-y-8">
                <!-- Dynamic Word Pools generated by JS -->
            </div>
        </section>

    </main>

    <!-- SECTION 4: Sticky Footer Preview -->
    <footer class="fixed bottom-0 left-0 w-full bg-white/80 backdrop-blur-xl border-t border-white/50 shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.1)] p-4 md:px-8 z-40 transition-all">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row gap-6 justify-between items-start md:items-center">
            <div class="flex-1 w-full">
                <div class="flex justify-between items-end mb-2">
                     <p class="text-xs text-blue-600 font-bold uppercase tracking-wider">Live Preview</p>
                     <span id="wordCount" class="text-[10px] text-slate-400 font-mono bg-slate-100 px-2 py-0.5 rounded">0 words</span>
                </div>
                <div id="previewText" class="text-xl font-serif text-slate-800 leading-relaxed min-h-[3.5rem] p-4 bg-white rounded-xl border border-slate-200 shadow-sm transition-colors">
                    Select a vibe above to generate...
                </div>
            </div>
            <div class="shrink-0 w-full md:w-auto self-center md:self-auto">
                <button onclick="copyToClipboard()" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-xl shadow-xl shadow-blue-500/20 transition-all flex items-center justify-center gap-2 active:scale-95 active:shadow-none hover:-translate-y-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                    </svg>
                    Copy Text
                </button>
            </div>
        </div>
    </footer>

    <!-- Success Toast -->
    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-8 py-4 rounded-full shadow-2xl opacity-0 transition-all duration-300 pointer-events-none z-50 flex items-center gap-3 translate-y-4 font-medium">
        <div class="bg-green-500 rounded-full p-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
        </div>
        <span>Copied to clipboard!</span>
    </div>

    <script>
        // --- DATA STRUCTURES ---
        
        const vibes = [
            {
                id: 'allrounder',
                title: 'All-Rounder',
                subtitle: 'High Achiever / å…¨èƒ½åž‹',
                icon: 'ðŸŒŸ',
                template: '{Name} is a {adj1} student with {adj2} potential. {He} has worked {adv} throughout the term and demonstrates a strong sense of {noun}. {His} {adj3} attitude is reflected in the high quality of {his} school work.',
                pools: {
                    adj1: ['capable (æœ‰èƒ½åŠ›çš„)', 'intelligent (è°ç©Žçš„)', 'earnest (èªçœŸçš„)', 'self-motivated (è‡ªå‹•è‡ªç™¼çš„)', 'disciplined (è‡ªå¾‹çš„)'],
                    adj2: ['excellent (å„ªç§€çš„)', 'promising (æœ‰å‰é€”çš„)', 'outstanding (å‚‘å‡ºçš„)', 'tremendous (æ¥µå¤§çš„)'],
                    adv: ['steadily (ç©©å®šåœ°)', 'conscientiously (èªçœŸåœ°)', 'diligently (å‹¤å¥®åœ°)', 'consistently (ä¸€è²«åœ°)'],
                    noun: ['responsibility (è²¬ä»»æ„Ÿ)', 'leadership (é ˜å°Žèƒ½åŠ›)', 'perseverance (æ¯…åŠ›)', 'integrity (æ­£ç›´)'],
                    adj3: ['sincere (çœŸèª çš„)', 'positive (ç©æ¥µçš„)', 'serious (åš´è‚…çš„)', 'mature (æˆç†Ÿçš„)']
                }
            },
            {
                id: 'quiet',
                title: 'Quiet & Diligent',
                subtitle: 'Steady Worker / æ–‡éœå‹¤å¥®åž‹',
                icon: 'ðŸ“š',
                template: '{Name} is a {adj1} and {adj2} student who shows great respect for teachers. {He} is a {adj3} worker who always completes assignments {adv}. With more {noun}, {he} will be able to perform even better.',
                pools: {
                    adj1: ['gentle (æº«å’Œçš„)', 'well-behaved (è¡Œç‚ºè‰¯å¥½çš„)', 'quiet (å®‰éœçš„)', 'calm (å†·éœçš„)'],
                    adj2: ['polite (æœ‰ç¦®è²Œçš„)', 'obedient (è½è©±çš„)', 'sincere (çœŸèª çš„)', 'courteous (è¬™æ­çš„)'],
                    adj3: ['steady (ç©©å®šçš„)', 'diligent (å‹¤å¥®çš„)', 'conscientious (èªçœŸçš„)', 'hardworking (åŠªåŠ›çš„)'],
                    adv: ['carefully (ä»”ç´°åœ°)', 'punctually (æº–æ™‚åœ°)', 'neatly (æ•´æ½”åœ°)', 'thoroughly (å¾¹åº•åœ°)'],
                    noun: ['confidence (è‡ªä¿¡)', 'initiative (ä¸»å‹•æ€§)', 'active participation (ç©æ¥µåƒèˆ‡)']
                }
            },
            {
                id: 'distracted',
                title: 'Capable but Distracted',
                subtitle: 'Needs Focus / æœ‰èƒ½åŠ›ä½†åˆ†å¿ƒåž‹',
                icon: 'ðŸ’¡',
                template: '{Name} is an {adj1} learner with good potential. However, {he} sometimes {verb} in class. If {he} can show more {noun} in {his} weak subjects, better results are expected.',
                pools: {
                    adj1: ['intelligent (è°ç©Žçš„)', 'smart (è°æ˜Žçš„)', 'agile (æ€ç¶­æ•æ·çš„)', 'active (æ´»èºçš„)'],
                    verb: ['lacks concentration (æ¬ ç¼ºé›†ä¸­åŠ›)', 'is talkative (å¤šè¨€)', 'daydreams (ç™¼ç™½æ—¥å¤¢)', 'gets distracted (å®¹æ˜“åˆ†å¿ƒ)'],
                    noun: ['determination (æ±ºå¿ƒ)', 'effort (åŠªåŠ›)', 'focus (å°ˆæ³¨)', 'patience (è€æ€§)']
                }
            },
            {
                id: 'leader',
                title: 'Helpful Leader',
                subtitle: 'Monitor/Service / é ˜è¢–æœå‹™åž‹',
                icon: 'ðŸ¤',
                template: '{Name} is a {adj1} and {adj2} student who gets along well with others. {He} deserves credit for discharging {his} duties as {role} faithfully. {He} is quick to accept advice and {phrase}.',
                pools: {
                    adj1: ['friendly (å‹å–„çš„)', 'helpful (æ¨‚æ–¼åŠ©äººçš„)', 'responsible (è² è²¬ä»»çš„)', 'kind (å–„è‰¯çš„)'],
                    adj2: ['reliable (å¯é çš„)', 'trustworthy (å€¼å¾—ä¿¡è³´çš„)', 'honest (èª å¯¦çš„)', 'committed (ç›¡è²¬çš„)'],
                    role: ['Class Monitor (ç­é•·)', 'Class Monitress (å¥³ç­é•·)', 'Prefect (é ˜è¢–ç”Ÿ)', 'IT Prefect (ITé ˜è¢–ç”Ÿ)', 'Subject Leader (ç§‘é•·)'],
                    phrase: ['eager to improve (æ¸´æœ›é€²æ­¥)', 'willing to serve (æ¨‚æ„æœå‹™)', 'sets a good example (æ¨¹ç«‹å¥½æ¦œæ¨£)']
                }
            },
            {
                id: 'social',
                title: 'Social & Energetic',
                subtitle: 'Active / ç¤¾äº¤æ´»èºåž‹',
                icon: 'âš¡',
                template: '{Name} is a very {adj1} and {adj2} student. While {he} is {adj3} and helpful to peers, {he} needs to find greater {noun} to achieve a higher academic standard.',
                pools: {
                    adj1: ['outgoing (å¤–å‘çš„)', 'energetic (å……æ»¿æ´»åŠ›çš„)', 'cheerful (é–‹æœ—çš„)', 'lively (æ´»æ½‘çš„)'],
                    adj2: ['positive (æ­£é¢çš„)', 'optimistic (æ¨‚è§€çš„)', 'upbeat (æ¨‚è§€çš„)', 'sociable (å–„æ–¼ç¤¾äº¤çš„)'],
                    adj3: ['friendly (å‹å–„çš„)', 'popular (å—æ­¡è¿Žçš„)', 'supportive (æ”¯æŒä»–äººçš„)', 'generous (å¤§æ–¹çš„)'],
                    noun: ['motivation (å‹•åŠ›)', 'academic focus (å­¸æ¥­å°ˆæ³¨)', 'attentiveness (å°ˆæ³¨åŠ›)']
                }
            },
            {
                id: 'sincere_careless',
                title: 'Friendly but Careless',
                subtitle: 'Need Details / å‹å–„ç²—å¿ƒåž‹',
                icon: 'ðŸ˜Š',
                template: '{Name} is a {adj1} and {adj2} student who gets along well with classmates. Greater success is expected if {he} pays more {noun}.',
                pools: {
                    adj1: ['sincere (çœŸèª çš„)', 'kind (å–„è‰¯çš„)', 'warm-hearted (ç†±å¿ƒçš„)', 'pleasant (ä»¤äººæ„‰å¿«çš„)'],
                    adj2: ['friendly (å‹å–„çš„)', 'polite (æœ‰ç¦®è²Œçš„)', 'helpful (æ¨‚æ–¼åŠ©äººçš„)', 'easy-going (éš¨å’Œçš„)'],
                    noun: ['attention to details (å°ç´°ç¯€çš„é—œæ³¨)', 'carefulness in work (å·¥ä½œçš„ç´°å¿ƒ)', 'patience (è€æ€§)']
                }
            },
            {
                id: 'smart_passive',
                title: 'Smart but Passive',
                subtitle: 'Lacks Drive / è°æ˜Žè¢«å‹•åž‹',
                icon: 'ðŸ¢',
                template: '{Name} is a {adj1} student but {he} lacks {noun1} to achieve a higher standard. {He} could make further progress in {his} studies by {phrase}.',
                pools: {
                    adj1: ['smart (è°æ˜Žçš„)', 'clever (éˆå·§çš„)', 'bright (è°ç©Žçš„)', 'capable (æœ‰èƒ½åŠ›çš„)'],
                    noun1: ['strong determination (å¼·å¤§çš„æ±ºå¿ƒ)', 'motivation (å‹•åŠ›)', 'initiative (ä¸»å‹•æ€§)', 'drive (å¹¹å‹)'],
                    phrase: ['working harder (æ›´åŠªåŠ›å·¥ä½œ)', 'taking an active role in learning (ç©æ¥µåƒèˆ‡å­¸ç¿’)', 'being more proactive (æ›´åŠ ä¸»å‹•)', 'setting higher goals (è¨­å®šæ›´é«˜ç›®æ¨™)']
                }
            },
            {
                id: 'social_talkative',
                title: 'Social but Talkative',
                subtitle: 'Needs Initiative / ç¤¾äº¤å¤šè¨€åž‹',
                icon: 'ðŸ’¬',
                template: '{Name} gets along well with others but is sometimes {adj1} in class. {He} is capable of making further progress if {he} shows more {noun} in {subject}.',
                pools: {
                    adj1: ['talkative (å¤šè¨€çš„)', 'chatty (æ„›èŠå¤©çš„)', 'distracted (åˆ†å¿ƒçš„)', 'restless (åç«‹ä¸å®‰çš„)'],
                    noun: ['initiative (ä¸»å‹•æ€§)', 'concentration (å°ˆæ³¨åŠ›)', 'effort (åŠªåŠ›)', 'seriousness (èªçœŸ)'],
                    subject: ['learning English (å­¸ç¿’è‹±èªž)', 'his studies (ä»–çš„å­¸æ¥­)', 'class participation (èª²å ‚åƒèˆ‡)', 'Mathematics (æ•¸å­¸)']
                }
            },
            {
                id: 'diligent_potential',
                title: 'Diligent & Potential',
                subtitle: 'Good Potential / å‹¤å¥®æ½›è³ªåž‹',
                icon: 'ðŸ“ˆ',
                template: '{Name} is a {adj1} student of {adj2} potential. {He} should continue to {phrase} for improvement.',
                pools: {
                    adj1: ['diligent (å‹¤å¥®çš„)', 'hardworking (åŠªåŠ›çš„)', 'conscientious (èªçœŸçš„)', 'steady (ç©©å®šçš„)'],
                    adj2: ['above-average (é«˜æ–¼å¹³å‡çš„)', 'good (è‰¯å¥½çš„)', 'promising (æœ‰å‰é€”çš„)', 'great (å·¨å¤§çš„)'],
                    phrase: ['work hard (åŠªåŠ›å·¥ä½œ)', 'strive for excellence (è¿½æ±‚å“è¶Š)', 'maintain his efforts (ä¿æŒåŠªåŠ›)', 'read more broadly (å»£æ³›é–±è®€)']
                }
            },
            {
                id: 'polite_unfocused',
                title: 'Polite but Unfocused',
                subtitle: 'Needs Concentration / æœ‰ç¦®æ¬ å°ˆæ³¨',
                icon: 'ðŸ§˜',
                template: '{Name} is {adj1} and {adj2} student. {He} could show more {noun} in {his} weak subjects, better results are expected.',
                pools: {
                    adj1: ['polite (æœ‰ç¦®è²Œçš„)', 'courteous (è¬™æ­çš„)', 'gentle (æº«å’Œçš„)', 'humble (è¬™è™›çš„)'],
                    adj2: ['obedient (è½è©±çš„)', 'well-behaved (è¡Œç‚ºè‰¯å¥½çš„)', 'respectful (å°Šé‡çš„)', 'quiet (å®‰éœçš„)'],
                    noun: ['concentration (å°ˆæ³¨åŠ›)', 'focus (ç„¦é»ž)', 'perseverance (æ¯…åŠ›)', 'determination (æ±ºå¿ƒ)']
                }
            }
        ];

        // --- UI FUNCTIONS ---

        function toggleInstructions() {
            const el = document.getElementById('instructions');
            el.classList.toggle('open');
        }

        // --- NAME FORMATTING LOGIC ---
        
        function toTitleCase(str) {
            if (!str) return "";
            return str.toLowerCase().split(' ').map(function(word) {
                return word.charAt(0).toUpperCase() + word.slice(1);
            }).join(' ');
        }

        function autoFormatNameInput() {
            const input = document.getElementById('studentName');
            input.value = toTitleCase(input.value);
            updatePreview();
        }

        // --- STATE MANAGEMENT ---
        let currentVibe = null;
        let selections = {};

        // --- INITIALIZATION ---
        function init() {
            renderVibeCards();
            updatePreview();
        }

        function renderVibeCards() {
            const container = document.getElementById('vibeContainer');
            container.innerHTML = '';
            
            vibes.forEach(vibe => {
                const card = document.createElement('div');
                card.className = `vibe-card bg-white border border-slate-200 rounded-xl p-5 flex items-start gap-4 select-none`;
                card.onclick = () => selectVibe(vibe.id, card);
                
                card.innerHTML = `
                    <div class="text-4xl bg-slate-50 p-3 rounded-2xl shrink-0 shadow-sm">${vibe.icon}</div>
                    <div class="pt-1">
                        <h3 class="font-bold text-slate-800 text-lg leading-tight">${vibe.title}</h3>
                        <p class="text-xs text-slate-500 font-medium mt-1 uppercase tracking-wide">${vibe.subtitle}</p>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- LOGIC ---
        
        function selectVibe(vibeId, cardElement) {
            currentVibe = vibes.find(v => v.id === vibeId);
            
            // UI Updates for Cards
            document.querySelectorAll('.vibe-card').forEach(c => c.classList.remove('active'));
            cardElement.classList.add('active');
            
            // Set Defaults
            selections = {};
            Object.keys(currentVibe.pools).forEach(key => {
                if (key === 'role') {
                    const roleOptions = getRoleOptions();
                    selections[key] = roleOptions[0].split(' (')[0];
                } else {
                    selections[key] = currentVibe.pools[key][0].split(' (')[0]; 
                }
            });
            
            renderWordPools();
            document.getElementById('customizationSection').classList.remove('hidden');
            
            // Mobile Scroll
            if(window.innerWidth < 768) {
                document.getElementById('customizationSection').scrollIntoView({behavior: 'smooth', block: 'start'});
            }
            
            updatePreview();
        }

        function getRoleOptions() {
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const originalRoles = currentVibe.pools.role || [];
            
            return originalRoles.filter(r => {
                if (r.includes('Class Monitor')) return gender === 'M';
                if (r.includes('Class Monitress')) return gender === 'F';
                return true;
            });
        }

        function handleGenderChange() {
            if (currentVibe && currentVibe.id === 'leader') {
                renderWordPools();
                const availableRoles = getRoleOptions().map(r => r.split(' (')[0]);
                if (!availableRoles.includes(selections.role)) {
                   selections.role = availableRoles[0];
                }
            }
            updatePreview();
        }

        function renderWordPools() {
            const container = document.getElementById('wordPools');
            container.innerHTML = '';
            
            Object.keys(currentVibe.pools).forEach(key => {
                const wrapper = document.createElement('div');
                wrapper.className = "border-b border-slate-100 pb-6 last:border-0 last:pb-0";
                
                const label = document.createElement('h4');
                label.className = "text-xs font-bold text-slate-400 uppercase tracking-widest mb-4";
                label.innerText = formatLabel(key);
                
                const chipsContainer = document.createElement('div');
                chipsContainer.className = "flex flex-wrap gap-3";
                
                let poolToRender = currentVibe.pools[key];
                if (key === 'role') {
                    poolToRender = getRoleOptions();
                }

                poolToRender.forEach(item => {
                    const parts = item.match(/^(.*?) \((.*?)\)$/);
                    const english = parts ? parts[1] : item;
                    const chinese = parts ? parts[2] : '';
                    
                    const chip = document.createElement('button');
                    const isSelected = selections[key] === english;
                    
                    chip.className = `word-chip px-5 py-3 rounded-xl border-2 text-left flex flex-col leading-tight ${isSelected ? 'active bg-blue-600 text-white border-blue-600' : 'bg-slate-50 text-slate-700 border-slate-200 hover:bg-white hover:border-blue-300'}`;
                    chip.onclick = () => {
                        selections[key] = english;
                        renderWordPools(); 
                        updatePreview();
                    };
                    
                    chip.innerHTML = `
                        <span class="font-bold text-base md:text-lg">${english}</span>
                        ${chinese ? `<span class="text-xs opacity-80 font-normal mt-0.5">${chinese}</span>` : ''}
                    `;
                    chipsContainer.appendChild(chip);
                });
                
                wrapper.appendChild(label);
                wrapper.appendChild(chipsContainer);
                container.appendChild(wrapper);
            });
        }
        
        function formatLabel(key) {
            if (key.startsWith('adj')) return 'Adjective / Description';
            if (key === 'adv') return 'Adverb';
            if (key.startsWith('noun')) return 'Noun / Quality';
            if (key === 'verb') return 'Verb';
            if (key === 'phrase') return 'Suggestion / Phrase';
            if (key === 'role') return 'Role / Duty';
            if (key === 'subject') return 'Subject / Area';
            return key;
        }

        function updatePreview() {
            const nameInput = document.getElementById('studentName');
            const rawName = nameInput.value.trim();
            // Auto-format name logic for Preview
            const formattedName = rawName ? toTitleCase(rawName) : "[Student Name]";
            
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const previewBox = document.getElementById('previewText');
            
            if (!currentVibe) {
                previewBox.innerHTML = '<span class="text-slate-400 italic">Select a vibe from Step 2 above to generate a comment.</span>';
                return;
            }

            let text = currentVibe.template;
            const pronouns = gender === 'M' 
                ? { sub: 'He', obj: 'him', poss: 'his' }
                : { sub: 'She', obj: 'her', poss: 'her' };
            
            // Gender Replacement
            text = text.replace(/{Name}/g, `<span class="font-bold text-slate-900">${formattedName}</span>`);
            text = text.replace(/{He}/g, pronouns.sub);
            text = text.replace(/{he}/g, pronouns.sub.toLowerCase());
            text = text.replace(/{His}/g, pronouns.poss.charAt(0).toUpperCase() + pronouns.poss.slice(1));
            text = text.replace(/{his}/g, pronouns.poss);
            text = text.replace(/{Him}/g, pronouns.obj.charAt(0).toUpperCase() + pronouns.obj.slice(1));
            text = text.replace(/{him}/g, pronouns.obj);

            // Word Selection Replacement
            Object.keys(selections).forEach(key => {
                const word = selections[key];
                const regex = new RegExp(`{${key}}`, 'g');
                text = text.replace(regex, `<span class="text-blue-600 font-semibold bg-blue-50 px-1 rounded border border-blue-100">${word}</span>`);
            });

            previewBox.innerHTML = text;
            
            // Count words (strip HTML)
            const plainText = previewBox.innerText;
            const count = plainText.trim().split(/\s+/).filter(w => w.length > 0).length;
            document.getElementById('wordCount').innerText = `${count} words`;
        }

        function copyToClipboard() {
            const previewDiv = document.getElementById('previewText');
            if (!currentVibe) return;
            const textToCopy = previewDiv.innerText;
            navigator.clipboard.writeText(textToCopy).then(() => {
                const toast = document.getElementById('toast');
                toast.classList.remove('opacity-0', 'translate-y-4');
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'translate-y-4');
                }, 2000);
            });
        }

        window.onload = init;

    </script>
</body>
</html>
